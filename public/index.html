<!DOCTYPE html>
<html>
<head>
  <title>Auto Complete</title>
  <head>
    <style>
      #resultSection {
        margin-top: 20px;
        padding: 10px;
        border: 1px solid #ccc;
        background-color: #f5f5f5;
      }
  
      #resultData {
        margin-top: 10px;
      }
  
      #resultData p {
        margin-bottom: 5px;
      }
    </style>
  </head>
</head>
<body style="display: flex; justify-content: center;">
  <h1>teste1</h1>
  <form action="/results" method="post">
    <label for="departureCity">Cidade de Partida:</label>
    <input type="text" id="departureCity" name="departureCity" oninput="fetchCities(this.value, 'departureCity')" list="suggestions"><br><br>

    <label for="arrivalCity">Cidade de Chegada:</label>
    <input type="text" id="arrivalCity" name="arrivalCity" oninput="fetchCities(this.value, 'arrivalCity')" list="suggestions"><br><br>

    <datalist id="suggestions"></datalist>

<br>
    
    <label for="departureDate">Data de Partida:</label>
    <input type="date" id="departureDate" name="departureDate"><br><br>

    <label for="departureReturnDate">Data de Volta:</label>
    <input type="date" id="departureReturnDate" name="departureReturnDate"><br><br>
    

    <input type="hidden" id="selectedDate" name="selectedDate"> <!-- Campo hidden para armazenar a data selecionada -->
    <button type="submit">Buscar</button>
  </form>

  <div id="resultSection" style="display: none;">
    <h2>Resultados da busca:</h2>
    <div id="resultData"></div>
  </div>

  <script>
    const departureCityInput = document.getElementById('departureCity');
    const arrivalCityInput = document.getElementById('arrivalCity');
    const suggestionsList = document.getElementById('suggestions');
    const departureDateInput = document.getElementById('departureDate'); // Adicionado para o campo de data
    const selectedDateInput = document.getElementById('selectedDate'); // Campo hidden para a data selecionada

    let data = [];

    async function fetchCities(query, inputId) {
      const apiUrl = `https://bff.clickbus.com/api/v4/places?clientId=2&limit=10000&name=${query}&fields=id,name,slug`;

      try {
        const response = await fetch(apiUrl);
        data = await response.json();

        suggestionsList.innerHTML = '';

        data.forEach(city => {
          const option = document.createElement('option');
          option.value = city.name;
          suggestionsList.appendChild(option);
        });

        if (inputId === 'departureCity') {
          updateInputValue(departureCityInput);
        } else if (inputId === 'arrivalCity') {
          updateInputValue(arrivalCityInput);
        }
      } catch (error) {
        console.error('Erro ao buscar cidades:', error);
      }
    }

    function formatInput(input) {
      const formattedText = input.value
        .toLowerCase()
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .replace(/\s+/g, '-')
        .replace(/[^a-z0-9-]/g, '');

      input.value = formattedText;
      fetchCities(formattedText, input.id);
    }

    function updateInputValue(inputElement) {
      const selectedOption = data.find(city => city.name === inputElement.value);
      if (selectedOption) {
        inputElement.value = selectedOption.slug; // Definindo o Slug como valor do input
      }
    }

    departureCityInput.addEventListener('input', function(event) {
      const selectedValue = event.target.value;
      fetchCities(selectedValue, 'departureCity');
    });

    arrivalCityInput.addEventListener('input', function(event) {
      const selectedValue = event.target.value;
      fetchCities(selectedValue, 'arrivalCity');
    });

    departureDateInput.addEventListener('input', function(event) {
      const selectedDate = event.target.value;
      selectedDateInput.value = selectedDate; // Atualiza o valor do campo hidden com a data selecionada
    });
  </script>
</body>
</html>
